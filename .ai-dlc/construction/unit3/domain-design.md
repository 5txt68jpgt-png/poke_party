# Unit 3 ドメイン設計 - バトル補助（相性判定）

## 概要

ポケモンバトルごっこ遊び中に「こうかはばつぐんだ！」を正しく言えるようにするための相性判定機能。

---

## ドメインモデル

### エンティティ・値オブジェクト

#### TypeEffectiveness（相性倍率）

```typescript
// 相性倍率の種類
type EffectivenessMultiplier = 0 | 0.25 | 0.5 | 1 | 2 | 4;

// 相性結果の種類
type EffectivenessResult =
  | "immune"      // 効果なし (0x)
  | "not_very"    // いまひとつ (0.25x, 0.5x)
  | "normal"      // 普通 (1x)
  | "super"       // ばつぐん (2x, 4x)
```

#### TypeChart（タイプ相性表）

18タイプ × 18タイプの相性を定義するデータ構造。

```typescript
// 攻撃タイプ → 防御タイプ → 倍率
type TypeChart = Record<PokemonTypeName, Record<PokemonTypeName, number>>;
```

---

## 相性計算ルール

### 基本倍率

| 相性 | 倍率 | 表示 |
|------|------|------|
| 効果なし | 0x | 「こうかがない...」 |
| いまひとつ | 0.5x | 「こうかはいまひとつのようだ」 |
| 普通 | 1x | （表示なし、または普通） |
| ばつぐん | 2x | 「こうかはばつぐんだ！」 |

### 複合タイプの計算

防御側が2つのタイプを持つ場合、各タイプへの倍率を乗算する。

例：
- 電気 → 水/飛行（ギャラドス）: 2 × 2 = 4倍（ばつぐん）
- 格闘 → 悪/ゴースト（サザンドラ等）: 2 × 0 = 0倍（効果なし）
- 氷 → 岩/地面: 2 × 2 = 4倍（ばつぐん）
- 電気 → 草/ドラゴン: 0.5 × 0.5 = 0.25倍（いまひとつ）

### 倍率と結果の対応

| 倍率 | 結果 |
|------|------|
| 0 | immune（効果なし） |
| 0.25 | not_very（いまひとつ） |
| 0.5 | not_very（いまひとつ） |
| 1 | normal（普通） |
| 2 | super（ばつぐん） |
| 4 | super（ばつぐん） |

---

## ユースケース

### UC-1: 技の相性を確認する

**アクター**: 親（ユーザー）

**フロー**:
1. パーティ表示画面で技をタップする
2. 相性チェックモーダルが開く
3. 相手ポケモンのタイプを選択する（1つまたは2つ）
4. 相性結果が表示される

**代替フロー**:
- 変化技（status）の場合は相性表示をスキップ

### UC-2: 技の詳細を確認する

**アクター**: 親（ユーザー）

**フロー**:
1. パーティ表示画面で技をタップする
2. 技詳細モーダルが開く
3. 技名、タイプ、分類、説明を確認する

---

## UI要件

### 相性チェックモーダル

- 技の情報（名前、タイプ、分類）を表示
- 相手タイプセレクター（18タイプから1〜2個選択）
- 結果表示エリア（倍率、メッセージ）
- 結果に応じた視覚的フィードバック（色分け）

### 結果表示メッセージ

| 倍率 | メッセージ | 色 |
|------|-----------|------|
| 0x | こうかがないようだ... | グレー |
| 0.25x | こうかはいまひとつだ | オレンジ |
| 0.5x | こうかはいまひとつだ | オレンジ |
| 1x | ふつうのダメージ | 白/デフォルト |
| 2x | こうかはばつぐんだ！ | 緑 |
| 4x | こうかはばつぐんだ！ | 緑（強調） |

---

## タイプ相性表データ

### データソース

公式のタイプ相性表に基づく18×18のマトリックス。
ソース: Bulbapedia / Pokemon Wiki

### 主要な相性パターン

**効果なし（0倍）の組み合わせ**:
- ノーマル → ゴースト
- ゴースト → ノーマル
- かくとう → ゴースト
- どく → はがね
- じめん → ひこう
- でんき → じめん
- エスパー → あく
- ドラゴン → フェアリー

**ばつぐん（2倍）の代表例**:
- ほのお → くさ, むし, こおり, はがね
- みず → ほのお, じめん, いわ
- でんき → みず, ひこう
- くさ → みず, じめん, いわ

---

## 用語集

| 用語 | 英語 | 説明 |
|------|------|------|
| ばつぐん | super effective | 2倍以上のダメージ |
| いまひとつ | not very effective | 0.5倍以下のダメージ |
| 効果なし | immune / no effect | 0倍（ダメージを与えられない） |
| 複合タイプ | dual type | 2つのタイプを持つポケモン |
| 攻撃タイプ | attack type | 技のタイプ |
| 防御タイプ | defense type | 相手ポケモンのタイプ |
