# Domain Design - Unit 5: パーティ生成改善

## 概要

パーティ生成の意外性を高め、おまかせ生成機能を追加する。

---

## ドメインモデル変更

### GenerationRequest（拡張）

| 属性 | 型 | 説明 |
|------|-----|------|
| theme | string? | ユーザー入力のテーマ（おまかせ時はnull） |
| count | number | 生成するポケモン数（1〜6） |
| mode | "theme" \| "random" | 生成モード（新規追加） |

### GenerationMode（新規）

| 値 | 説明 |
|----|------|
| theme | ユーザーがテーマを指定して生成 |
| random | AIがテーマを生成して生成（おまかせ） |

---

## AIプロンプト設計

### 既存プロンプトの問題点

```
テーマに合うポケモンを選んでください
```
→ AIが「代表的な」「有名な」ポケモンを優先的に選択

### 改善方針

1. **ランダム性の明示的指示**
   - 「ランダムに」「毎回異なる」を強調

2. **有名どころ回避**
   - 「御三家を避ける」「マイナーポケモンを含める」

3. **多様性の確保**
   - 「進化段階を混ぜる」「異なる世代から選ぶ」

### テーマ指定モード用プロンプト

```
あなたはポケモンの専門家です。
ユーザーが指定したテーマに合うポケモンをランダムに選んでください。

ルール:
1. 実在するポケモンの英語名（小文字、ハイフンあり）のみを返してください
2. 指定された数のポケモンを選んでください
3. テーマに合わないポケモンは選ばないでください
4. 必ずJSON形式のみで返してください（説明文は不要）
5. 御三家（最初に選べるポケモン）やメジャーなポケモンばかりにならないようにしてください
6. マイナーなポケモンや意外な選択も積極的に含めてください
7. 毎回異なる結果になるよう、ランダム性を重視してください

出力形式（必ずこの形式で）:
{"pokemon": ["pikachu", "charizard", "blastoise"]}
```

### おまかせモード用プロンプト

```
あなたはポケモンの専門家です。
ユーザーのためにランダムなテーマを考え、そのテーマに合うポケモンを選んでください。

ルール:
1. まず面白いテーマを1つ考えてください（例：「青いポケモン」「鳥ポケモン」「かわいい系」など）
2. そのテーマに合うポケモンを指定数選んでください
3. 実在するポケモンの英語名（小文字、ハイフンあり）のみを返してください
4. 必ずJSON形式のみで返してください
5. 御三家やメジャーなポケモンばかりにならないようにしてください
6. マイナーなポケモンも積極的に含めてください

出力形式（必ずこの形式で）:
{"theme": "考えたテーマ", "pokemon": ["pokemon1", "pokemon2", "pokemon3"]}
```

---

## ユースケース

### UC-1: おまかせ生成

**フロー**:
1. ユーザーが「おまかせ生成」ボタンをタップ
2. システムがおまかせモードでAPIを呼び出し
3. AIがテーマとポケモンを同時生成
4. PokeAPIでバリデーション・データ取得
5. 技選定
6. パーティ表示（生成されたテーマも表示）

### UC-2: テーマ指定生成（改善版）

**フロー**:
1. ユーザーがテーマを入力
2. システムがテーマモードでAPIを呼び出し
3. AIが改善されたプロンプトでランダム選定
4. 以降は既存フローと同じ

---

## 用語集

| 用語 | 説明 |
|------|------|
| おまかせ生成 | テーマもAIに任せる生成モード |
| テーマ指定生成 | ユーザーがテーマを入力する従来の生成モード |
| 意外性 | 予想外のポケモンが選ばれること |
| マイナーポケモン | 一般的に認知度の低いポケモン |
