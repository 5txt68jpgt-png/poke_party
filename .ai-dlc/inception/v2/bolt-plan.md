# Bolt Plan v2 - パーティ生成の改善

## 概要

v2の改善を1つのUnitで実装する。
変更は主にAIプロンプトとUI部分のみ。

---

## Unit 構成

```
Unit 5: パーティ生成改善
```

---

## Unit 5: パーティ生成改善

### 目的
パーティ生成の意外性を高め、おまかせ生成機能を追加する

### 対応ストーリー
- US-V2-1（おまかせ生成）
- US-V2-2（意外性のあるパーティ）
- US-V2-3（テーマ入力との両立）
- US-V2-4（再生成での変化）

### 成果物
- AIプロンプト改善（ランダム性向上）
- おまかせ生成API
- UI更新（おまかせボタン追加）

### Bolt（実装タスク）

| Bolt | タスク | 詳細 |
|------|--------|------|
| 5-1 | プロンプト改善 | ランダム性向上、有名どころ回避の指示追加 |
| 5-2 | おまかせAPI | テーマ+パーティ同時生成のAPI実装 |
| 5-3 | UI更新 | おまかせ生成ボタン追加、レイアウト調整 |
| 5-4 | テスト | ランダム性・テーマ適合性の確認 |
| 5-5 | デプロイ | 本番環境へデプロイ |

### 完了条件
- [ ] おまかせ生成ボタンで1回のAPIコールでパーティ生成できる
- [ ] 同じテーマで複数回生成しても異なるポケモンが出る
- [ ] テーマ入力での生成も従来通り動作する
- [ ] 本番環境にデプロイ済み

---

## 技術詳細

### プロンプト改善方針

**現在のプロンプト（問題点）:**
```
テーマに合うポケモンを選んでください
→ AIが「代表的な」ポケモンを選びがち
```

**改善後のプロンプト:**
```
テーマに合うポケモンをランダムに選んでください。
- 御三家や有名なポケモンばかりにならないようにしてください
- マイナーなポケモンも積極的に含めてください
- 毎回違う結果になるようにしてください
```

### おまかせ生成API設計

**エンドポイント**: POST /api/generate-party

**リクエスト（おまかせモード）:**
```typescript
{
  mode: "random",
  count: number
}
```

**レスポンス:**
```typescript
{
  party: {
    theme: string,  // AIが生成したテーマ
    members: PartyPokemon[]
  }
}
```

### UI変更

```
┌─────────────────────────────────────┐
│ ┌─────────────────────────────────┐ │
│ │       おまかせ生成              │ │  ← 新規追加
│ └─────────────────────────────────┘ │
│                                     │
│ ─────────── または ───────────     │  ← 区切り
│                                     │
│ テーマを入力                         │
│ ┌─────────────────────────────────┐ │
│ │ 例：かわいいポケモン            │ │
│ └─────────────────────────────────┘ │
│ [おすすめテーマボタン...]            │
│                                     │
│ ポケモン数: [3匹 ▼]                 │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │        パーティ生成             │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

---

## リスク

| リスク | 影響 | 対策 |
|--------|------|------|
| ランダム性が高すぎてテーマ外れ | 高 | プロンプトでテーマ厳守を強調 |
| おまかせのテーマが面白くない | 中 | プロンプトで多様なテーマ生成を指示 |
| API応答時間の増加 | 低 | 同時生成で1コールに抑える |

---

## 見積もり

| Bolt | 作業量 |
|------|--------|
| 5-1 | 小 |
| 5-2 | 中 |
| 5-3 | 小 |
| 5-4 | 小 |
| 5-5 | 小 |
| **合計** | **小〜中** |
